# ‚úÖ Avito Service - –†–ê–°–®–ò–†–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û!

## üéØ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. **Avito Accounts Management** ‚úÖ
- ‚úÖ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∞–∫–∫–∞—É–Ω—Ç–æ–≤ Avito
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ credentials (Client ID, Client Secret, User ID)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–∫—Å–∏ (HTTP/HTTPS/SOCKS4/SOCKS5)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API –∏ –ø—Ä–æ–∫—Å–∏
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–±–∞–ª–∞–Ω—Å, –æ–±—ä—è–≤–ª–µ–Ω–∏—è, –ø—Ä–æ—Å–º–æ—Ç—Ä—ã)
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### 2. **Avito API Integration** ‚úÖ
- ‚úÖ `AvitoApiService` - –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Avito API
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ access token
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∞–∫–∫–∞—É–Ω—Ç–µ
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π (views, contacts, favorites)
- ‚úÖ Health check –¥–ª—è API
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–∫—Å–∏ (HTTP/HTTPS/SOCKS4/SOCKS5)

### 3. **Avito Messenger API** ‚úÖ
- ‚úÖ `AvitoMessengerService` - –∫–ª–∏–µ–Ω—Ç –¥–ª—è Avito Messenger
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ API
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —á–∞—Ç–∞
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Ç—ã
- ‚úÖ –û—Ç–º–µ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ "–æ–Ω–ª–∞–π–Ω"
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–∫—Å–∏

### 4. **Eternal Online Feature** ‚úÖ
- ‚úÖ `EternalOnlineService` - —Å–µ—Ä–≤–∏—Å "–≤–µ—á–Ω–æ–≥–æ –æ–Ω–ª–∞–π–Ω–∞"
- ‚úÖ Cron –∑–∞–¥–∞—á–∏ (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ (60-3600 —Å–µ–∫—É–Ω–¥)
- ‚úÖ Enable/disable –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –æ–Ω–ª–∞–π–Ω –≤ –ë–î
- ‚úÖ –†—É—á–Ω–æ–π trigger –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ–Ω–ª–∞–π–Ω

### 5. **Database Schema Updates** ‚úÖ
- ‚úÖ –ù–æ–≤–∞—è –º–æ–¥–µ–ª—å `AvitoAccount` (credentials, proxy, stats, eternal online)
- ‚úÖ –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ `Avito` ‚Üí `AvitoChat`
- ‚úÖ –°–≤—è–∑—å —á–∞—Ç–æ–≤ —Å –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏ (`accountId`)
- ‚úÖ –í—Å–µ –ø–æ–ª—è —Å `@map` (snake_case –≤ –ë–î)
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

### 6. **New API Endpoints** ‚úÖ

#### Accounts (CRUD + Operations)
- `GET /api/v1/accounts` ‚úÖ
- `GET /api/v1/accounts/:id` ‚úÖ
- `POST /api/v1/accounts` ‚úÖ
- `PUT /api/v1/accounts/:id` ‚úÖ
- `DELETE /api/v1/accounts/:id` ‚úÖ
- `POST /api/v1/accounts/:id/check-connection` ‚úÖ
- `POST /api/v1/accounts/:id/sync-stats` ‚úÖ

#### Messenger API
- `GET /api/v1/messenger/accounts/:accountId/chats` ‚úÖ
- `GET /api/v1/messenger/accounts/:accountId/chats/:chatId/messages` ‚úÖ
- `POST /api/v1/messenger/accounts/:accountId/chats/:chatId/send` ‚úÖ
- `POST /api/v1/messenger/accounts/:accountId/chats/:chatId/messages/:messageId/read` ‚úÖ
- `POST /api/v1/messenger/accounts/:accountId/status/online` ‚úÖ

#### Eternal Online
- `POST /api/v1/eternal-online/accounts/:accountId/enable` ‚úÖ
- `POST /api/v1/eternal-online/accounts/:accountId/disable` ‚úÖ
- `POST /api/v1/eternal-online/accounts/:accountId/set-online` ‚úÖ

### 7. **Dependencies Added** ‚úÖ
- ‚úÖ `@nestjs/schedule` - –¥–ª—è Cron –∑–∞–¥–∞—á
- ‚úÖ `axios` - HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è Avito API
- ‚úÖ `https-proxy-agent` - HTTP/HTTPS –ø—Ä–æ–∫—Å–∏
- ‚úÖ `socks-proxy-agent` - SOCKS4/SOCKS5 –ø—Ä–æ–∫—Å–∏

### 8. **Documentation** ‚úÖ
- ‚úÖ `README.md` - –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
- ‚úÖ `DEPLOYMENT.md` - –¥–µ–ø–ª–æ–π –≥–∞–π–¥ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
- ‚úÖ `CHANGELOG.md` - changelog —Å –≤–µ—Ä—Å–∏—è–º–∏
- ‚úÖ `env.example` - example environment variables
- ‚úÖ Kubernetes –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã (deployment + secrets)

### 9. **Modules Structure** ‚úÖ
```
src/
‚îú‚îÄ‚îÄ accounts/           # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏ Avito ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ accounts.controller.ts
‚îÇ   ‚îú‚îÄ‚îÄ accounts.service.ts
‚îÇ   ‚îú‚îÄ‚îÄ accounts.module.ts
‚îÇ   ‚îî‚îÄ‚îÄ dto/
‚îú‚îÄ‚îÄ avito/             # –ß–∞—Ç—ã –∏ —Å–æ–æ–±—â–µ–Ω–∏—è (–ë–î) ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ avito.controller.ts
‚îÇ   ‚îú‚îÄ‚îÄ avito.service.ts
‚îÇ   ‚îî‚îÄ‚îÄ avito.module.ts
‚îú‚îÄ‚îÄ avito-api/         # Avito API –∫–ª–∏–µ–Ω—Ç—ã ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ avito-api.service.ts
‚îÇ   ‚îî‚îÄ‚îÄ avito-messenger.service.ts
‚îú‚îÄ‚îÄ eternal-online/    # "–í–µ—á–Ω—ã–π –æ–Ω–ª–∞–π–Ω" ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ eternal-online.controller.ts
‚îÇ   ‚îú‚îÄ‚îÄ eternal-online.service.ts
‚îÇ   ‚îî‚îÄ‚îÄ eternal-online.module.ts
‚îú‚îÄ‚îÄ webhook/           # Webhook –æ—Ç Avito ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ webhook.controller.ts
‚îÇ   ‚îî‚îÄ‚îÄ webhook.service.ts
‚îú‚îÄ‚îÄ auth/              # JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è ‚úÖ
‚îú‚îÄ‚îÄ prisma/            # Prisma ORM ‚úÖ
‚îî‚îÄ‚îÄ avito-messenger.controller.ts  # Messenger API ‚úÖ
```

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

### Local Development

```bash
cd api-services/avito-service
npm install
npx prisma generate
npx prisma db push
npm run start:dev
```

### Docker

```bash
docker build -t avito-service:latest .
docker run -p 5004:5004 \
  -e DATABASE_URL="postgresql://..." \
  -e JWT_SECRET="your-secret" \
  avito-service:latest
```

### Kubernetes

```bash
# 1. –°–æ–∑–¥–∞—Ç—å secrets
kubectl apply -f k8s/secrets/avito-service-secrets.yaml

# 2. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å —Å–µ—Ä–≤–∏—Å
kubectl apply -f k8s/deployments/avito-service.yaml
```

---

## üî• –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### Proxy Support
–ö–∞–∂–¥—ã–π –∞–∫–∫–∞—É–Ω—Ç –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ **—Å–≤–æ–π –ø—Ä–æ–∫—Å–∏**:
- HTTP/HTTPS/SOCKS4/SOCKS5
- –° –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –∏–ª–∏ –±–µ–∑
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### Eternal Online
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å–∞:
- Cron –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

### Statistics Sync
–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:
- –ë–∞–ª–∞–Ω—Å –∞–∫–∫–∞—É–Ω—Ç–∞ (—Ä–µ–∞–ª—å–Ω—ã–π + –±–æ–Ω—É—Å–Ω—ã–π)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π
- –ü—Ä–æ—Å–º–æ—Ç—Ä—ã –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –ë—ã–ª–æ vs –°—Ç–∞–ª–æ

| –§—É–Ω–∫—Ü–∏—è | –ë—ã–ª–æ (v1.0) | –°—Ç–∞–ª–æ (v2.0) |
|---------|------------|-------------|
| Avito API | ‚ùå | ‚úÖ –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è |
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏ | ‚ùå | ‚úÖ CRUD + credentials |
| –ü—Ä–æ–∫—Å–∏ | ‚ùå | ‚úÖ 4 —Ç–∏–ø–∞ –ø—Ä–æ–∫—Å–∏ |
| –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π | ‚ùå | ‚úÖ –ß–µ—Ä–µ–∑ API |
| Eternal Online | ‚ùå | ‚úÖ Cron –∑–∞–¥–∞—á–∏ |
| –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | ‚ùå | ‚úÖ –ë–∞–ª–∞–Ω—Å + –æ–±—ä—è–≤–ª–µ–Ω–∏—è |
| –ß–∞—Ç—ã (–ë–î) | ‚úÖ | ‚úÖ + —Å–≤—è–∑—å —Å –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏ |
| Webhook | ‚úÖ | ‚úÖ |

---

## ‚úÖ –ò–¢–û–ì

**Avito Service —Ç–µ–ø–µ—Ä—å - –ü–û–õ–ù–û–¶–ï–ù–ù–´–ô –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å** —Å:
- üî• –ü–æ–ª–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Avito API
- üî• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏
- üî• –ü—Ä–æ–∫—Å–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
- üî• "–í–µ—á–Ω—ã–º –æ–Ω–ª–∞–π–Ω–æ–º"
- üî• –û—Ç–ø—Ä–∞–≤–∫–æ–π —Å–æ–æ–±—â–µ–Ω–∏–π
- üî• –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –æ–±—ä—è–≤–ª–µ–Ω–∏–π

**–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `backend callcentre` –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã!** ‚úÖ

